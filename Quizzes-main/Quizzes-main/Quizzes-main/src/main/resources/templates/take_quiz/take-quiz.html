<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title th:text="${quiz.title + ' - Quiz Online'}">Quiz Online</title>

    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" th:href="@{/images/favicon.ico}" />

    <!-- CSS Libraries -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet" />

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;600&display=swap" rel="stylesheet" />

    <!-- Custom CSS -->
    <link th:href="@{/assets/take_quiz/css/take-quiz.css}" rel="stylesheet" />

    <!-- Add CSRF tokens -->
    <meta name="_csrf" th:content="${_csrf.token}"/>
    <meta name="_csrf_header" th:content="${_csrf.headerName}"/>

    <style>
        :root {
            --space-xs: 0.5rem;
            --space-sm: 0.75rem; 
            --space-md: 1rem;
            --space-lg: 1.5rem;
            --space-xl: 2rem;
        }
    </style>
</head>
<body class="quiz-mode">
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg fixed-top">
        <div class="container-fluid px-4">
            <a class="navbar-brand" th:href="@{/auth/welcome}">
                <i class="fas fa-graduation-cap"></i> Quiz Online
            </a>
            <div class="d-flex align-items-center">
                <div class="quiz-info-compact me-3">
                    <span class="badge bg-light">
                        <i class="fas fa-clock"></i> 
                        <span id="timer" 
                              th:with="mins=${attempt.remainingTime / 60}, 
                                       secs=${attempt.remainingTime % 60}"
                              th:text="${mins + ':' + #numbers.formatInteger(secs, 2)}">45:00</span>
                    </span>
                    <span class="badge bg-light">
                        <i class="fas fa-tasks"></i> 
                        <span>Question:</span> 
                        <span id="current-question">1</span>/<span th:text="${#lists.size(quiz.questions)}">30</span>
                    </span>
                </div>
                 <a  class="btn btn-danger btn-sm"  id="exit-quiz" th:href="@{/answer/list}">

                    <i class="fas fa-times"></i> <span class="d-none d-sm-inline">Exit</span>
                  </a>
                <!-- <button class="btn btn-danger btn-sm">
                 
                </button> -->
            </div>
        </div>
    </nav>

    <div class="quiz-container">
        <!-- Left Sidebar - Quiz info & Questions grid -->
        <aside class="sidebar-left">
            <div class="sidebar-section quiz-info">
                <h5 class="section-title">Quiz Information</h5>
                <div class="info-grid">
                    <div class="info-item">
                        <i class="fas fa-star"></i>
                        <div class="info-content">
                            <span class="info-label">Maximum Score</span>
                            <span class="info-value" th:text="${quiz.totalScore}">100</span>
                        </div>
                    </div>
                    <div class="info-item">
                        <i class="fas fa-clock"></i>
                        <div class="info-content">
                            <span class="info-label">Time Limit</span>
                            <span class="info-value" th:text="${quiz.timeLimit + ' minutes'}">45</span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="sidebar-section questions-section">
                <h5 class="section-title">Question List</h5>
                <div class="questions-grid">
                    <th:block th:each="question, stat : ${quiz.questions}">
                        <button type="button" class="question-btn"
                                th:classappend="${stat.first ? 'current' : ''}"
                                th:attr="data-question=${stat.index + 1}"
                                th:text="${stat.index + 1}">1</button>
                    </th:block>
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <div class="main-wrapper">
            <main class="main-content">
                <!-- Progress Section -->
                <div class="quiz-progress-section">
                    <div class="progress-stats-compact">
                        <div class="stat-chip total">
                            <i class="fas fa-list"></i>
                            <span>Total:</span>
                            <span class="value" th:text="${quiz.totalQuestions}">30</span>
                        </div>
                        <div class="stat-chip answered">
                            <i class="fas fa-check"></i>
                            <span>Answered:</span>
                            <span class="value" id="answered-count">0</span>
                        </div>
                        <div class="stat-chip marked">
                            <i class="fas fa-flag"></i>
                            <span>Marked:</span>
                            <span class="value" id="marked-count">0</span>
                        </div>
                    </div>

                    <div class="progress-bar-compact">
                        <div class="progress-fill-compact answered" id="progress-answered"></div>
                        <div class="progress-fill-compact marked" id="progress-marked"></div>
                    </div>
                </div>

                <!-- Questions Container -->
                <div class="questions-container">
                    <div class="quiz-header-section">
                        <h1 class="quiz-title" th:text="${quiz.title}">Quiz</h1>
                    </div>
                    <div class="questions-wrapper">
                        <th:block th:each="question, stat : ${quiz.questions}">
                            <div class="question-content" 
                                 th:id="'question-' + ${question.orderIndex}"
                                 th:data-question-type="${question.questionType}"
                                 th:style="${question.orderIndex == 1 ? '' : 'display: none;'}">
                                <div class="question-header">
                                    <div class="question-number-badge">
                                        <span th:text="'Question ' + ${question.orderIndex}">Question 1</span>
                                  
                                    </div>
                                    <p class="question-text" th:text="${question.questionText}">Question text</p>
                                </div>

                                <div class="form-check-list">
                                    <!-- TRUE_FALSE Questions -->
                                    <th:block th:if="${question.questionType == 'TRUE_FALSE'}">
                                        <div class="form-check" th:data-question-number="${stat.count}">
                                            <input type="radio" th:name="'q' + ${question.questionId}" 
                                                   th:id="'q' + ${question.questionId} + '_' + ${stat.count} + '_true'" 
                                                   th:value="${question.answers[0].answerId}">
                                            <label th:for="'q' + ${question.questionId} + '_' + ${stat.count} + '_true'">
                                                <span class="answer-text">True</span>
                                            </label>
                                        </div>
                                        <div class="form-check" th:data-question-number="${stat.count}">
                                            <input type="radio" th:name="'q' + ${question.questionId}" 
                                                   th:id="'q' + ${question.questionId} + '_' + ${stat.count} + '_false'" 
                                                   th:value="${question.answers[1].answerId}">
                                            <label th:for="'q' + ${question.questionId} + '_' + ${stat.count} + '_false'">
                                                <span class="answer-text">False</span>
                                            </label>
                                        </div>
                                    </th:block>
                                    <!-- Other Question Types -->
                                    <th:block th:if="${question.questionType != 'TRUE_FALSE'}">
                                        <div class="form-check" 
                                             th:each="answer : ${question.answers}"
                                             th:data-question-number="${stat.count}">
                                            <input th:type="${question.questionType == 'SINGLE_CHOICE' ? 'radio' : 'checkbox'}"
                                                   th:name="'q' + ${question.questionId}"
                                                   th:id="'q' + ${question.questionId} + '_' + ${answer.answerId}"
                                                   th:value="${answer.answerId}">
                                            <label th:for="'q' + ${question.questionId} + '_' + ${answer.answerId}">
                                                <span class="answer-text" th:text="${answer.answerText}"></span>
                                            </label>
                                        </div>
                                    </th:block>
                                </div>
                            </div>
                        </th:block>
                    </div>
                </div>
            </main>

            <!-- Navigation Footer -->
            <footer class="navigation-controls">
                <button class="nav-button prev" id="prev-question">
                    <i class="fas fa-chevron-left"></i> Previous
                </button>
                <div class="center-actions">
                    <button class="nav-button mark" id="mark-review">
                        <i class="fas fa-flag"></i> Mark
                    </button>
                    <button class="nav-button submit" id="submit-quiz">
                        <i class="fas fa-paper-plane"></i> Submit
                    </button>
                </div>
                <button class="nav-button next" id="next-question">
                    Next <i class="fas fa-chevron-right"></i>
                </button>
            </footer>
        </div>
    </div>

    <!-- Redesigned Submit Modal -->
    <div class="modal fade" id="submitConfirmModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content submit-modal">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="fas fa-paper-plane"></i>
                        Confirm Submission
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                
                <div class="modal-body p-0">
                    <!-- Quiz title section -->
                    <div class="quiz-title-banner">
                        <h6 class="mb-0" th:text="${quiz.title}">Quiz Title</h6>
                    </div>
                    
                    <!-- Statistics visualization -->
                    <div class="submit-visualization-container">
                        <div class="submit-progress-indicator">
                            <div class="progress-circle">
                                <svg viewBox="0 0 36 36" class="progress-ring">
                                    <path class="progress-ring-bg"
                                          d="M18 2.0845
                                            a 15.9155 15.9155 0 0 1 0 31.831
                                            a 15.9155 15.9155 0 0 1 0 -31.831"/>
                                    <path class="progress-ring-fill" id="progress-ring-path"
                                          stroke-dasharray="0, 100"
                                          d="M18 2.0845
                                            a 15.9155 15.9155 0 0 1 0 31.831
                                            a 15.9155 15.9155 0 0 1 0 -31.831"/>
                                </svg>
                                <div class="progress-text">
                                    <span id="progress-percentage">0%</span>
                                    <span class="progress-label">completed</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="submit-statistics">
                            <div class="stat-item">
                                <i class="fas fa-check-circle"></i>
                                <div class="stat-data">
                                    <span class="stat-value">
                                        <span id="answered-count-modal">0</span>/<span id="total-questions-modal">0</span>
                                    </span>
                                    <span class="stat-label">Questions Answered</span>
                                </div>
                            </div>
                            
                            <div class="stat-item">
                                <i class="fas fa-clock"></i>
                                <div class="stat-data">
                                    <span class="stat-value" id="remaining-time-modal">00:00</span>
                                    <span class="stat-label">Remaining Time</span>
                                </div>
                            </div>
                            
                            <div class="stat-item">
                                <i class="fas fa-question-circle"></i>
                                <div class="stat-data">
                                    <span class="stat-value">
                                        <span id="unanswered-count-modal">0</span> questions
                                    </span>
                                    <span class="stat-label">Unanswered</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Confirmation message -->
                    <div class="submit-confirmation-message">
                        <div class="alert alert-info">
                            <i class="fas fa-info-circle"></i>
                            <span>Are you sure you want to submit this quiz? You won't be able to change your answers after submission.</span>
                        </div>
                    </div>
                </div>
                
                <div class="modal-footer submit-modal-footer">
                    <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">
                        <i class="fas fa-arrow-left me-2"></i>
                        Continue Quiz
                    </button>
                    <button type="button" class="btn btn-primary submit-btn" id="confirm-submit">
                        <i class="fas fa-paper-plane me-2"></i>
                        Submit Quiz
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Enhanced Timeout Modal -->
    <div class="modal fade" id="timeoutModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header bg-danger">
                    <h5 class="modal-title text-white">
                        <i class="fas fa-clock-o me-2"></i>Time's Up!
                    </h5>
                </div>
                <div class="modal-body text-center p-4">
                    <div class="timeout-icon mb-3">
                        <i class="fas fa-hourglass-end fa-3x text-danger"></i>
                    </div>
                    <h4 class="timeout-title mb-3">Time has expired</h4>
                    <div class="timeout-stats p-3 bg-light rounded mb-3">
                        <p class="mb-2">You have answered:</p>
                        <h3 class="text-primary mb-0">
                            <span id="answered-count-timeout">0</span>
                            <span class="text-muted">/</span>
                            <span id="total-questions-timeout" class="text-muted">0</span>
                            <span class="fs-6 text-muted">questions</span>
                        </h3>
                    </div>
                    <div class="alert alert-warning">
                        <i class="fas fa-info-circle me-2"></i>
                        Your answers have been saved. Please click Submit to finish.
                    </div>
                </div>
                <div class="modal-footer justify-content-center border-0 pt-0">
                    <button type="button" class="btn btn-primary px-4 py-2" id="submit-timeout">
                        <i class="fas fa-paper-plane me-2"></i>Submit Quiz
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script th:inline="javascript">
        window.quizData = {
            quizId: [[${quiz.quizId}]],
            attemptId: [[${attempt.attemptId}]],
            timeLimit: [[${attempt.remainingTime}]],
            totalQuestions: [[${quiz.totalQuestions}]],
            totalScore: [[${quiz.totalScore}]],
            status: [[${attempt.attemptStatus}]]
        };
    </script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script th:src="@{/assets/take_quiz/js/take-quiz.js}"></script>
</body>
</html>
