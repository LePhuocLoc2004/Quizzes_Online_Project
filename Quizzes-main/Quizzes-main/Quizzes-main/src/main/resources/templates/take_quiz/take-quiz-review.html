<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Quiz Results</title>
    <!-- CSS libraries -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link th:href="@{/assets/take_quiz/css/take-quiz-review.css}" rel="stylesheet">
</head>
<body class="quiz-result-mode">
    <!-- Quiz Result Layout -->
    <nav class="navbar navbar-expand-lg fixed-top">
        <div class="container-fluid px-4">
            <a class="navbar-brand" th:href="@{/auth/welcome}">
                <i class="fas fa-graduation-cap"></i> Quiz Online
            </a>
            <div class="d-flex">
				<a th:href="@{/history/{userId}(userId=${#authentication.principal.userId})}" class="btn btn-outline-primary me-2">
					<i class="fas fa-history me-1"></i> History
				</a>
                <a th:href="@{/answer/list}" class="btn btn-outline-primary me-2">
                    <i class="fas fa-list"></i> Quiz List
                </a>
                <a th:href="@{/auth/welcome}" class="btn btn-danger">
                    <i class="fas fa-times"></i> Exit
                </a>
            </div>
        </div>
    </nav>

    <div class="quiz-container">
        <!-- Result Summary Sidebar -->
        <aside class="sidebar-left">
            <div class="result-summary">
                <!-- Status Badge -->
                <div class="status-badge" 
                     th:class="${'status-badge ' + 
                         (result.attemptStatus == 'COMPLETED' ? 'completed' : 
                         result.attemptStatus == 'INCOMPLETE' ? 'incomplete' : 
                         result.attemptStatus == 'TIMEOUT' ? 'timeout' : '')}">
                    <div class="status-icon">
                        <i th:class="${
                            result.attemptStatus == 'COMPLETED' ? 'fas fa-check-circle' :
                            result.attemptStatus == 'INCOMPLETE' ? 'fas fa-exclamation-circle' :
                            result.attemptStatus == 'TIMEOUT' ? 'fas fa-clock' :
                            'fas fa-question-circle'
                        }"></i>
                    </div>
                    <span class="status-value" th:text="${
                        result.attemptStatus == 'COMPLETED' ? 'Completed' :
                        result.attemptStatus == 'INCOMPLETE' ? 'Incomplete' :
                        result.attemptStatus == 'TIMEOUT' ? 'Time Out' :
                        'Unknown'
                    }">Completed</span>
                </div>
                
                <!-- Score -->
                <div class="score-display">
                    <h3 th:text="${result.score + '/' + result.maxScore}">85/100</h3>
                    <span>Score</span>
                </div>

                <!-- Statistics -->
                <div class="stats-grid">
                    <!-- Progress -->
                    <div class="stat-item">
                        <i class="fas fa-tasks"></i>
                        <div class="stat-content">
                            <span>Progress</span>
                            <span th:text="${result.answeredCount + '/' + result.totalQuestions}">
                                25/30 questions
                            </span>
                        </div>
                    </div>
                    
                    <!-- Time -->
                    <div class="stat-item">
                        <i class="fas fa-clock"></i>
                        <div class="stat-content">
                            <span>Time Spent</span>
                            <span th:with="spentMins=${result.timeSpent / 60}, 
                                           spentSecs=${result.timeSpent % 60},
                                           limitMins=${result.timeLimit / 60},
                                           limitSecs=${result.timeLimit % 60}"
                                  th:text="${#numbers.formatInteger(spentMins,2) + ':' + #numbers.formatInteger(spentSecs,2) + '/' + 
                                           #numbers.formatInteger(limitMins,2) + ':' + #numbers.formatInteger(limitSecs,2)}">
                                35:42/45:00
                            </span>
                        </div>
                    </div>
                    
                    <!-- Start Time -->
                    <div class="stat-item">
                        <i class="fas fa-play"></i>
                        <div class="stat-content">
                            <span>Start Time</span>
                            <span th:text="${#dates.format(result.startTime, 'dd/MM/yyyy HH:mm:ss')}">
                                01/01/2024 15:30:00
                            </span>
                        </div>
                    </div>
                    
                    <!-- End Time -->
                    <div class="stat-item">
                        <i class="fas fa-stop"></i>
                        <div class="stat-content">
                            <span>End Time</span>
                            <span th:text="${#dates.format(result.endTime, 'dd/MM/yyyy HH:mm:ss')}">
                                01/01/2024 16:15:00
                            </span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Questions Grid -->
            <div class="questions-grid">
                <th:block th:each="question : ${result.questions}">
                    <button type="button" class="question-btn"
                            th:classappend="${
                                question.isCorrect == null ? '' :
                                question.isCorrect ? 'correct' : 'incorrect'
                            }"
                            th:attr="data-question=${question.orderIndex}"
                            th:text="${question.orderIndex}">1</button>
                </th:block>
            </div>
        </aside>

        <!-- Main Content -->
        <div class="main-wrapper">
            <!-- Questions Display -->
            <main class="main-content">
                <div class="questions-container">
                    <h1 class="quiz-title" th:text="${result.quizTitle}">Quiz Title</h1>
                    
                    <div class="questions-wrapper">
                        <th:block th:each="question : ${result.questions}">
                            <div class="question-content" 
                                 th:id="'question-' + ${question.orderIndex}"
                                 th:style="${question.orderIndex == 1 ? '' : 'display: none;'}">
                                
                                <div class="question-header">
                                    <div class="question-number">
                                        <span th:text="'Question ' + ${question.orderIndex}+' '">Q1</span>
                                        <span th:class="${
                                            question.isCorrect == null ? 'no-answer' :
                                            question.isCorrect ? 'correct' : 'incorrect'
                                        }">
                                            <i th:class="${
                                                question.isCorrect == null ? 'fas fa-minus' :
                                                question.isCorrect ? 'fas fa-check' : 'fas fa-times'
                                            }"></i>
                                        </span>
                                    </div>
                                    <p class="question-text" th:text="${question.questionText}">Question content goes here</p>
                                </div>

                                <div class="answers-list">
                                    <div th:each="answer : ${question.answers}" 
                                         class="answer-item"
                                         th:classappend="${
                                             answer.isCorrect ? 'correct-answer' : ''
                                         } + ' ' + ${
                                             answer.isSelected ? (
                                                 answer.isCorrect ? 'user-correct' : 'user-incorrect'
                                             ) : (
                                                 question.questionType == 'MULTIPLE_CHOICE' && 
                                                 answer.isCorrect ? 'missed-correct' : ''
                                             )
                                         }">
                                        <input type="radio" th:if="${question.questionType != 'MULTIPLE_CHOICE'}"
                                               th:checked="${answer.isSelected}"
                                               disabled>
                                        <input type="checkbox" th:if="${question.questionType == 'MULTIPLE_CHOICE'}"
                                               th:checked="${answer.isSelected}"
                                               disabled>
                                        <label th:text="${answer.answerText}">Answer option</label>
                                    </div>
                                </div>
                            </div>
                        </th:block>
                    </div>
                </div>
            </main>

            <!-- Navigation Footer -->
            <footer class="navigation-controls">
                <button class="nav-button prev" id="prev-question" disabled>
                    <i class="fas fa-chevron-left"></i>
                    <span>Previous</span>
                </button>
                <div class="nav-center">
                    <span class="question-counter">
                        Question <span id="current-question">1</span>/<span th:text="${result.totalQuestions}">30</span>
                    </span>
                </div>
                <button class="nav-button next" id="next-question">
                    <span>Next</span>
                    <i class="fas fa-chevron-right"></i>
                </button>
            </footer>
        </div>
    </div>

    <!-- Scripts -->
    <script th:inline="javascript">
        window.quizResult = {
            totalQuestions: [[${result.totalQuestions}]]
        };
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script th:src="@{/assets/take_quiz/js/take-quiz-review.js}"></script>
</body>
</html>
